{"version":3,"file":"service-account-auth-header-injector.js","sourceRoot":"","sources":["../../../../src/commons/middleware/service-account-auth-header-injector.ts"],"names":[],"mappings":"AAAA,OAAO,EACH,aAAa,EACb,sBAAsB,GACzB,MAAM,2BAA2B,CAAC;AAEnC,OAAO,EAAE,aAAa,EAAE,MAAM,sBAAsB,CAAC;AACrD,OAAO,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAElD,MAAM,MAAM,GAAG,aAAa,CAAC,SAAS,CAAC,mCAAmC,CAAC,CAAC;AAE5E,aAAa,CAAC,aAAa,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAEzD,MAAM,CAAC,MAAM,gCAAgC,GAAG,KAAK,EACjD,WAAwB,EACJ,EAAE;IACtB,MAAM,CAAC,KAAK,CAAC,qCAAqC,CAAC,CAAC;IACpD,MAAM,KAAK,GAAG,MAAM,sBAAsB,EAAE,CAAC;IAC7C,MAAM,CAAC,KAAK,CAAC,iDAAiD,CAAC,CAAC;IAEhE,MAAM,OAAO,GAAG,IAAI,OAAO,CAAC,WAAW,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC;IACvD,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,UAAU,KAAK,EAAE,CAAC,CAAC;IAEhD,OAAO;QACH,GAAG,WAAW;QACd,OAAO,EAAE,OAAO;KACnB,CAAC;AACN,CAAC,CAAC","sourcesContent":["import {\n    configAuthLib,\n    getServiceAccountToken,\n} from '@republic-global/auth-lib';\n\nimport { commonsConfig } from '../commons-config.js';\nimport { LoggerFactory } from '../utils/index.js';\n\nconst logger = LoggerFactory.getLogger('FetchAuthServiceAccountMiddleware');\n\nconfigAuthLib(commonsConfig.authLib.serviceAccountToken);\n\nexport const serviceAccountAuthHeaderInjector = async (\n    requestInit: RequestInit\n): Promise<RequestInit> => {\n    logger.debug('Retrieving service account token...');\n    const token = await getServiceAccountToken();\n    logger.debug('Successfully retrieved service account token...');\n\n    const headers = new Headers(requestInit.headers || {});\n    headers.set('Authorization', `Bearer ${token}`);\n\n    return {\n        ...requestInit,\n        headers: headers,\n    };\n};\n"]}